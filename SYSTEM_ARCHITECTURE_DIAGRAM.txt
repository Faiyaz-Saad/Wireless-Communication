ESP32-C6 LoRa Mesh Communication System - Complete Architecture
================================================================

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    MOBILE DEVICE A                                                              │
│                                                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                ANDROID APPLICATION                                                       │   │
│  │                                                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │   │
│  │  │  WebSocket  │  │ Bluetooth   │  │   WiFi      │  │    HTTP     │  │   Storage   │                 │   │
│  │  │   Client    │  │  Manager    │  │  Manager    │  │   Client    │  │   Manager   │                 │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘                 │   │
│  │         │                │                │                │                │                         │   │
│  │         ▼                ▼                ▼                ▼                ▼                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐ │   │
│  │  │                          COMMUNICATION INTERFACE                                                │ │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ WiFi AP / Bluetooth / HTTP
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    ESP32-C6 NODE 1                                                             │
│                                                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                ESP32-C6 DEVELOPMENT BOARD                                                │   │
│  │                                                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐ │   │
│  │  │                              ESP32-C6 MCU                                                        │ │   │
│  │  │                                                                                                 │ │   │
│  │  │  Built-in Modules:                                                                              │ │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │   │
│  │  │  │   WiFi      │  │ Bluetooth   │  │   GPIO      │  │    ADC      │  │   Memory    │         │ │   │
│  │  │  │   Module    │  │   Module    │  │   Pins      │  │  (12-bit)   │  │   (SPIFFS)  │         │ │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         │ │   │
│  │  │         │                │                │                │                │                 │ │   │
│  │  │         ▼                ▼                ▼                ▼                ▼                 │ │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐ │ │   │
│  │  │  │                        FIRMWARE COMPONENTS                                              │ │ │   │
│  │  │  │                                                                                         │ │ │   │
│  │  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │ │ │   │
│  │  │  │  │   WiFi      │  │ Bluetooth   │  │   LoRa      │  │   OLED      │  │   Battery   │ │ │ │   │
│  │  │  │  │   Server    │  │   Server    │  │   Manager   │  │   Display   │  │   Monitor   │ │ │ │   │
│  │  │  │  │   (AP)      │  │   (Serial)  │  │   (Mesh)    │  │   (I2C)     │  │   (ADC)     │ │ │ │   │
│  │  │  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │ │ │   │
│  │  │  │         │                │                │                │                │         │ │ │   │
│  │  │  │         ▼                ▼                ▼                ▼                ▼         │ │ │   │
│  │  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │ │ │   │
│  │  │  │  │                    COMMUNICATION MODES                                          │ │ │ │   │
│  │  │  │  │                                                                                 │ │ │ │   │
│  │  │  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                            │ │ │ │   │
│  │  │  │  │  │    MESH     │  │   DIRECT    │  │    AUTO     │                            │ │ │ │   │
│  │  │  │  │  │    MODE     │  │    MODE     │  │    MODE     │                            │ │ │ │   │
│  │  │  │  │  │ (Multi-hop) │  │ (Point-to- │  │ (Adaptive)  │                            │ │ │ │   │
│  │  │  │  │  │             │  │   point)    │  │             │                            │ │ │ │   │
│  │  │  │  │  └─────────────┘  └─────────────┘  └─────────────┘                            │ │ │ │   │
│  │  │  │  └─────────────────────────────────────────────────────────────────────────────────┘ │ │ │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────────────┘ │ │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ GPIO Connections
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    EXTERNAL HARDWARE                                                           │
│                                                                                                                 │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐           │
│  │   LoRa Module       │  │   OLED Display      │  │   Battery Monitor   │  │   Status LEDs       │           │
│  │  (E220-900T22D)     │  │   (0.96" I2C)       │  │  (Voltage Divider)  │  │   (Status/Mesh/BT)  │           │
│  │                     │  │                     │  │                     │  │                     │           │
│  │  VCC ──── 3.3V      │  │  VCC ──── 3.3V      │  │  Battery+ ──[10kΩ]─┼─│  GPIO6 ──[LED]─── GND │           │
│  │  GND ──── GND       │  │  GND ──── GND       │  │         └─[10kΩ]─┼─│  GPIO9 ──[LED]─── GND │           │
│  │  TX  ──── GPIO4     │  │  SDA ──── GPIO7     │  │         └─ A0 ────┼─│  GPIO10 ──[LED]─── GND │           │
│  │  RX  ──── GPIO5     │  │  SCL ──── GPIO8     │  │  Battery- ── GND  │  │                     │           │
│  │  ANT ──── External  │  │                     │  │                     │  │                     │           │
│  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ LoRa Radio (868/915MHz)
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    ESP32-C6 NODE 2                                                             │
│                                    (Identical Setup)                                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ WiFi AP / Bluetooth / HTTP
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    MOBILE DEVICE B                                                              │
│                                    (Identical Setup)                                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

COMMUNICATION FLOW DIAGRAM
==========================

Mobile A ──┐
           ├── WiFi AP ───────────► ESP32-C6 Node 1 ──┐
           ├── Bluetooth ─────────►                   ├── LoRa Radio ──┐
           ├── HTTP/WebSocket ────►                   │               │
           └── Web Interface ─────►                   └───┐           │
                                                          │           │
                                                          ▼           │
                                                   ┌─────────────┐    │
                                                   │  Processing │    │
                                                   │  & Routing  │    │
                                                   └─────────────┘    │
                                                          │           │
                                                          ▼           │
ESP32-C6 Node 2 ◄────────── LoRa Radio ◄────────────────┘           │
     │                                                                 │
     ├── WiFi AP ───────────► Mobile B ──┐                           │
     ├── Bluetooth ─────────►            ├── WebSocket Connection     │
     ├── HTTP/WebSocket ────►            ├── Bluetooth Serial        │
     └── Web Interface ─────►            ├── HTTP POST/GET           │
                                         └── Web Interface           │
                                                                     │
MESSAGE TYPES & PROTOCOLS                                            │
=======================                                             │
                                                                     │
┌─────────────────────────────────────────────────────────────────────┐
│  Text Messages    │ JSON/Plain Text │ All Channels                 │
│  Image Messages   │ Base64 Encoded  │ LoRa (Fragmented)            │
│  Audio Messages   │ Binary Data     │ LoRa (Fragmented)            │
│  Control Commands │ JSON/AT Commands│ All Channels                 │
│  Status Updates   │ JSON            │ WebSocket/HTTP               │
└─────────────────────────────────────────────────────────────────────┘

WEBSOCKET SERVER IMPLEMENTATION
===============================

┌─────────────────────────────────────────────────────────────────────────────┐
│                              ESP32-C6 WebSocket Server                     │
│                                                                             │
│  Port: 8080                                                                 │
│  Endpoint: /ws                                                              │
│  Protocol: WebSocket over HTTP                                              │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Connection Handling                          │   │
│  │                                                                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │   Client    │  │   Client    │  │   Client    │  │   Client    │ │   │
│  │  │ Connection  │  │ Connection  │  │ Connection  │  │ Connection  │ │   │
│  │  │   Pool      │  │   Pool      │  │   Pool      │  │   Pool      │ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  │         │                │                │                │       │   │
│  │         ▼                ▼                ▼                ▼       │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │                    Message Broadcasting                         │ │   │
│  │  │                                                                 │ │   │
│  │  │  Receive Message ──► Process ──► Broadcast to All Clients      │ │   │
│  │  └─────────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        LoRa Integration                             │   │
│  │                                                                     │   │
│  │  WebSocket Message ──► LoRa Packet ──► Mesh Network ──► Remote Node │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘

PERFORMANCE SPECIFICATIONS
==========================

Communication Latency:
├── WebSocket: 10-50ms (local network)
├── Bluetooth: 100-200ms (serial processing)
├── LoRa Direct: 50-100ms (single hop)
└── LoRa Mesh: 200-500ms (multi-hop)

Range Capabilities:
├── LoRa: Up to 5km (line of sight)
├── WiFi: ~100m (AP range)
├── Bluetooth: ~10m (classic), ~100m (BLE)
└── Mesh Network: Unlimited (with nodes)

Power Consumption:
├── ESP32-C6: ~240mA (active), ~10μA (sleep)
├── LoRa Module: ~120mA (TX), ~15mA (RX)
├── OLED Display: ~20mA
└── Total System: ~400mA (peak), ~35mA (idle)
